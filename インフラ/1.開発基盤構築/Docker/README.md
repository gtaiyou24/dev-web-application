# Docker
*Dockerはコンテナ型の仮想化環境を提供するオープンソースソフトウェアである。VMware製品などの完全仮想化を行うハイパーバイザ型製品と比べて、ディスク使用量は少なく、仮想環境 (インスタンス) 作成や起動は速く、性能劣化がほとんどないという利点を持つ。*

[「Docker - Wikipedia」](https://ja.wikipedia.org/wiki/Docker)より引用

<br>
　ローカル環境でアプリケーションを開発して、その開発したアプリを本番環境へデプロイするとする。もしこのときアプリケーションの実行環境(OS、ミドルウェア、パッケージバージョン、etc)が開発していたローカル環境と異なっている場合、デプロイ時に何らかのエラーが発生するでしょう。実際、Dockerなどの仮想化環境ツールが利用される前まではこのような問題がよくありました。<br>
　この問題の解決策として**開発を行うローカル環境は本番環境と同じ環境で行う**という方法が挙げられました。この方法を実現するには2通り考えられます。まず一つは**Linuxの物理サーバを開発チームで新たに用意し、本番環境と同じ開発環境で構築する**。しかし、これを実現するためには物理サーバの設置場所・電力の確保を行い、ハードウェを購入して、用意した物理サーバを管理しなければならず、莫大なコストが発生します。二つめは、ローカル環境上で**仮想的にサーバを構築して、その仮想環境で開発する**という実現方法があります。この方法は物理サーバを持たないので、設置場所・電力の確保、ハードウェアの購入、メンテナンスが不要になります。<br>
　この仮想的にOSを動かし、その上でアプリケーションを動作させる環境を**仮想環境**と呼びます。

<img src="./docs/imgs/仮想化の構成.png" width="85%">


　以下に現在使われている代表的な仮想化技術を紹介します。

|   | ホスト型仮想化 | ハイパーバイザー型仮想化 | コンテナ型仮想化 |
|:-:|:-------------|:---------------------|:---------------|
| イメージ | ![](./docs/imgs/ホスト型仮想化.png) | ![](./docs/imgs/ハイパーバイザー型仮想化.png) | ![](./docs/imgs/コンテナ型仮想化.png) |
| 概要 | ハードウェアの上にベースとなるホストOSをインストールし、ホストOSに仮想化ソフトウェアをインストール。その仮想化ソフトウェアの上でゲストOSを動作させる仮想化環境 | ハードウェア上に仮想化を専門に行うソフトウェアである「ハイパーバイザー」を配置し、ハードウェアと仮想環境を制御する。Amazon EC2でも用いられている技術。 | ホストOS上に論理的な区画(コンテナ)を作り、アプリケーションを動作させるのに必要なライブラリやアプリケーションなどをコンテナ内に閉じ込め、個別のサーバのように使うことができるようにしたもの。ホストOSのリソースを論理的に分割し、複数のコンテナで共有して使う |
| 長所/欠点 | 仮想化ソフトをインストールして手軽に仮想環境が構築できる/ホストOSの上でゲストOSを動かすため、オーバーヘッドが大きくなる | ホストOSがなく直接ハードウェアを制御するため、リソースを効率よく使用できる/仮想環境ごとに別のOSが動作するため、仮想環境の起動にかかるオーバーヘッドは大きくなる | オーバーヘッドが少ないため、軽量で高速に動作する/× |
| ツール | VMWare Player, Oracle VM VirtualBox | Hyper-V, XenServer | Docker |

---
## Dockerの特徴

> #### 移植性(ポータビリティ)
> 一度作ってしまえばどこでも動くソフトウェアの特性のこと。システム開発で開発環境・テスト環境・本番環境のアプリケーションの実行に必要なインフラ環境をコンテナとして管理し、そのコンテナからDockerイメージとして作成・配布・稼働することで「開発/テスト環境では動くけど、本番環境では動かない」リスクを減らすことができる。

<br>

> #### 相互接続性(インターオペラビリティ)
> 様々な組織やシステムと連携して使うことができるソフトウェアの特性のこと。

---
## Dockerの基本機能
Dockerには、大きく分けて以下の三つの機能がある。

#### Dockerイメージを作る機能
プログラム本体/ライブラリ/ミドルウェアや、OSやネットワークの設定などを一つにまとめて**Dockerイメージ**を作ります。Dockerイメージは、実行環境で動くコンテナのもと(ひな形)になります。

 - Dockerイメージ正体は、アプリケーションの実行に必要なファイル群が格納された**ディレクトリ**

#### Dockerコンテナを動かす機能
Dockkerは、Linux上でコンテナ単位でサーバ機能を動かす。このコンテナのもとになるのが、Dockerイメージである。

<img src="./docs/imgs/コンテナの実行.png" width="80%">

Dockerは、一つのLinuxカーネルを複数のコンテナで共有している。コンテナ内で動作するプロセスを1つのグループとして管理し、グループごとにそれぞれファイルシステムやホスト名/ネットワークなどを割り当てている。

#### Dockerイメージを公開/共有する機能


#### Dockerコンポーネント

 - Docker Registry(イメージ公開/共有)
 - Docker Compose(複数コンテナ一元管理)
 - Docker Machine(Docker実行環境構築)

---
## Dockerが動く仕組み

**コンテナが区画化する仕組み**(namespace)

**リソース管理の仕組み**(cgroup)

**Dockerイメージのデータ管理の仕組み**